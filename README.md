See the step-* branches for the code...
